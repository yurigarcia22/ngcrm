<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NG PROSPECT</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Configura√ß√£o do Tailwind para Cores Personalizadas -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-dark-blue': '#202C6D',
                        'brand-coral': '#F75E67',
                        'brand-coral-dark': '#E65358',
                        'brand-base-white': '#FFFFFF',
                        'brand-base-gray': '#F5F5F5',
                        'brand-text-dark': '#1a202c',
                        'brand-text-light': '#E2E8F0',
                    }
                }
            }
        }
    </script>

    <!-- React e Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@1.28.7/dist/supabase.min.js"></script>

    <!-- SheetJS (xlsx) -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #F5F5F5;
            overflow: hidden;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #e2e8f0;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        .kanban-column.drag-over {
            background-color: rgba(247, 94, 103, 0.1);
        }

        .prospect-card.dragging {
            opacity: 0.5;
            transform: rotate(3deg);
        }

        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0.7;
            animation: fall 4s linear forwards;
        }

        @keyframes fall {
            0% {
                transform: translateY(-10vh) rotate(0deg);
                opacity: 1;
            }

            100% {
                transform: translateY(110vh) rotate(720deg);
                opacity: 0;
            }
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, Fragment } = React;

        // --- Inicializando o Supabase ---
        const supabaseUrl = 'https://ekzjsqheinpvebjfjims.supabase.co'; // URL do seu Supabase
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVrempzcWhlaW5wdmViamZqaW1zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA5OTIzNDMsImV4cCI6MjA2NjU2ODM0M30.HrBFnV6ve6po2GeitFXs55ensNljsXs-1aSVwdKHDDA'; // Substitua pela chave p√∫blica do Supabase
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        // --- DADOS MOCKADOS E CONSTANTES ---
        const initialUsers = [{
                id: 1,
                name: 'Sofia',
                avatar: 'üë©‚Äçüíª'
            },
            {
                id: 2,
                name: 'Carlos',
                avatar: 'üë®‚Äçüíº'
            },
            {
                id: 3,
                name: 'Ana',
                avatar: 'üë©‚Äçüî¨'
            }
        ];
        const KANBAN_STAGES = ['Novo', 'Contato Inicial', 'Contato com Decisor', 'Proposta Enviada', 'Venda', 'Perdido', 'No Show'];
        const initialProspects = [{
                id: 1,
                name: 'Tech Solutions Inc.',
                contactName: 'Roberto Silva',
                value: 15000,
                status: 'Novo',
                userId: 1,
                email: 'roberto.silva@techsolutions.com',
                phone: '(11) 98765-4321',
                editHistory: []
            },
            {
                id: 2,
                name: 'Inova Marketing Digital',
                contactName: 'Mariana Costa',
                value: 8000,
                status: 'Contato Inicial',
                userId: 2,
                email: 'mariana.costa@inova.com',
                phone: '(21) 91234-5678',
                editHistory: []
            },
            {
                id: 3,
                name: 'Global Logistics',
                contactName: 'Fernando Almeida',
                value: 25000,
                status: 'Contato com Decisor',
                userId: 1,
                email: 'fernando.a@globallog.net',
                phone: '(31) 99988-7766',
                editHistory: []
            },
            {
                id: 4,
                name: 'Advocacia & Associados',
                contactName: 'Beatriz Lima',
                value: 22000,
                status: 'Venda',
                userId: 2,
                email: 'beatriz.lima@adv.com',
                phone: '(61) 96655-4433',
                editHistory: []
            },
        ];
        const initialTasks = [{
            id: 1,
            prospectId: 2,
            userId: 2,
            description: "Cad√™ncia: Liga√ß√£o, Conex√£o",
            dueDate: '2025-06-26',
            completed: true,
            type: 'Cad√™ncia'
        }];
        const CRM_FIELDS = ['name', 'contactName', 'email', 'phone', 'value', 'status'];
        const CRM_FIELD_LABELS = {
            name: 'Nome da Empresa',
            contactName: 'Nome do Contato',
            email: 'E-mail',
            phone: 'Telefone',
            value: 'Valor da Proposta',
            status: 'Status'
        };

        // --- COMPONENTES ---

        function Confetti() {
            const confettiCount = 150;
            const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50', '#8bc34a', '#cddc39', '#ffeb3b', '#ffc107', '#ff9800', '#ff5722'];
            const particles = useMemo(() => Array.from({
                length: confettiCount
            }).map((_, i) => ({
                id: i,
                color: colors[Math.floor(Math.random() * colors.length)],
                left: `${Math.random() * 100}%`,
                animationDelay: `${Math.random() * 4}s`,
                duration: `${2 + Math.random() * 2}s`,
                transform: `rotate(${Math.random() * 360}deg)`
            })), []);
            return (<div className="confetti-container">{particles.map(p => (<div key={p.id} className="confetti" style={{
                    backgroundColor: p.color,
                    left: p.left,
                    animationDuration: p.duration,
                    animationDelay: p.animationDelay,
                    transform: p.transform
                }} />))}</div>);
        }

        function App() {
            const [user, setUser] = useState(null);
            const [email, setEmail] = useState("");
            const [password, setPassword] = useState("");
            const [prospects, setProspects] = useState(initialProspects);
            const [tasks, setTasks] = useState(initialTasks);
            const [users] = useState(initialUsers);
            const [showConfetti, setShowConfetti] = useState(false);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [isImportModalOpen, setIsImportModalOpen] = useState(false);
            const [selectedProspect, setSelectedProspect] = useState(null);
            const [selectedIds, setSelectedIds] = useState([]);

            // --- Autentica√ß√£o ---
            useEffect(() => {
                const session = supabase.auth.session();
                setUser(session?.user || null);

                const {
                    data: authListener
                } = supabase.auth.onAuthStateChange((event, session) => {
                    setUser(session?.user || null);
                });

                return () => {
                    authListener?.unsubscribe();
                };
            }, []);

            const handleLogin = async () => {
                try {
                    const {
                        user,
                        error
                    } = await supabase.auth.signIn({
                        email,
                        password
                    });
                    if (error) throw error;
                    alert(`Bem-vindo, ${user.email}`);
                } catch (error) {
                    alert(error.message);
                }
            };

            const handleLogout = async () => {
                await supabase.auth.signOut();
                alert("Voc√™ foi desconectado");
            };

            if (!user) {
                return (
                    <div className="login-container">
                        <h2>Login</h2>
                        <input type="email" value={email} onChange={(e) => setEmail(e.target.value)} placeholder="Email" />
                        <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} placeholder="Senha" />
                        <button onClick={handleLogin}>Entrar</button>
                    </div>
                );
            }

            // --- O resto do c√≥digo permanece com as fun√ß√µes de Kanban, ListView, Tasks, etc. ---

            return (
                <div className="flex-1 p-4 sm:p-6 lg:p-8 space-y-8 custom-scrollbar overflow-y-auto">
                    <div className="flex justify-between items-center">
                        <div>
                            <h1 className="text-3xl font-semibold text-brand-text-dark lowercase">dashboard</h1>
                            <p className="text-gray-500">vis√£o geral das suas m√©tricas de prospec√ß√£o</p>
                        </div>
                        <button onClick={handleLogout}>Sair</button>
                    </div>

                    {/* O resto do conte√∫do de prospects, tarefas e outros componentes */}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

    </script>
</body>

</html>
